// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Classes {
  id   Int    @id
  name String

  // used in
  Specs Specs[]
}

model Specs {
  id   Int    @id
  name String

  classId Int
  class   Classes @relation(fields: [classId], references: [id])

  role String
}

model Dungeons {
  id   Int    @id
  name String @db.Char(40)
  slug String @db.Char(8)
  time Int

  // used in
  Fights Fights[]
}

model Affixes {
  id       Int     @id
  name     String
  icon     String
  seasonal Boolean

  // used in
  firstAffix  Weeks[]   @relation("firstAffix")
  secondAffix Weeks[]   @relation("secondAffix")
  thirdAffix  Weeks[]   @relation("thirdAffix")
  Seasons     Seasons[]
}

model Expansions {
  id Int @id @default(autoincrement())

  name String
  slug String

  // used in
  Seasons Seasons[]
}

model Seasons {
  id Int @id @default(autoincrement())

  name      String
  slug      String
  startTime DateTime
  endTime   DateTime?

  expansionId Int
  expansion   Expansions @relation(fields: [expansionId], references: [id])

  affixId Int?
  affix   Affixes? @relation(fields: [affixId], references: [id])

  // used in
  Weeks Weeks[]
}

model Weeks {
  id Int @id @default(autoincrement())

  seasonId Int
  season   Seasons @relation(fields: [seasonId], references: [id])

  seasonWeekId Int

  affix1Id   Int
  firstAffix Affixes @relation("firstAffix", fields: [affix1Id], references: [id])

  affix2Id    Int
  secondAffix Affixes @relation("secondAffix", fields: [affix2Id], references: [id])

  affix3Id   Int
  thirdAffix Affixes @relation("thirdAffix", fields: [affix3Id], references: [id])

  // used in
  Fights Fights[]

  @@unique([seasonId, seasonWeekId])
}

model Reports {
  id        Int      @id @default(autoincrement())
  report    String   @unique @db.Char(16)
  region    String
  title     String
  startTime DateTime
  endTime   DateTime

  // used in
  Fights Fights[]
}

model Fights {
  id Int @id @default(autoincrement())

  fightId Int

  reportId Int
  report   Reports @relation(fields: [reportId], references: [id])

  dungeonId Int
  dungeon   Dungeons @relation(fields: [dungeonId], references: [id])

  keystoneTime     Int
  keystoneLevel    Int
  chests           Int
  dps              Int
  hps              Int
  dtps             Int
  totalDeaths      Int
  averageItemLevel String

  weekId Int
  week   Weeks @relation(fields: [weekId], references: [id])

  @@unique([fightId, reportId])
}

model Characters {
  id Int @id @default(autoincrement())

  guid Int    @unique
  name String

  server String
}

// model Reports {
//   id    Int    @id @default(autoincrement())
//   code  String @unique @db.Char(16)
//   start Int
//   end   Int

//   // used in
//   Fights Fights[]
// }

// model Fights {
//   fightId  Int
//   reportId Int
//   report   Reports @relation(fields: [reportId], references: [id])

//   dungeonId Int
//   dungeon   Dungeons @relation(fields: [dungeonId], references: [id])

//   keyLevel Int

//   tankId Int
//   tank   Character @relation("tank-character", fields: [tankId], references: [id])

//   healId Int
//   heal   Character @relation("heal-character", fields: [healId], references: [id])

//   dps1Id Int
//   dps1   Character @relation("dps1-character", fields: [dps1Id], references: [id])

//   dps2Id Int
//   dps2   Character @relation("dps2-character", fields: [dps2Id], references: [id])

//   dps3Id Int
//   dps3   Character @relation("dps3-character", fields: [dps3Id], references: [id])

//   deaths Int
//   time   Int

//   @@id([reportId, fightId])
// }

// model Character {
//   id     Int    @id
//   name   String @db.Char(21)
//   realm  String @db.Char(30)
//   region String @db.Char(3)

//   tank Fights[] @relation("tank-character")
//   heal Fights[] @relation("heal-character")
//   dps1 Fights[] @relation("dps1-character")
//   dps2 Fights[] @relation("dps2-character")
//   dps3 Fights[] @relation("dps3-character")
// }
